{% extends "base.html" %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="/media/js/flowplayer-3.js"></script>
    {% if user.is_authenticated and camera.show %}
    <script src="/media/js/jquery-1.4.2.min.js"></script>
    <script src="/media/js/underscore-min.js"></script>
    <script src="/media/js/socket.io.js"></script>
    <script src="/media/js/client-io.js"></script>
    {% endif %}
{% endblock %}

{% block content %}

<h1>{{ page_user }}'s home</h1>
    {% if user.avatar %}
        <img src="{% url social:avatar user_id=page_user.id format='100x100' %}" />
    {% else %}
        <img src="/media/img/notfound/avatar_100x100.png" />
    {% endif %}

{% if show_friend_button %}
<p>
    <a href="{% url social:friend user_id=page_user.id %}">
        Add to my friends
    </a>
</p>
{% endif %}

<div id="content-main">

    {% if user.is_authenticated %}
    <div class="messages">
        <form method="POST"
              action="{% url social:send_message user_id=page_user.id %}">
        <table summary="Leave a message to {{ page_user }}" width="100%">
            <caption>Leave a message</caption>
            {{ msgform.as_table }}
            <tr><td colspan="2"><input type="submit" value="Send"/></td></tr>
        </table>
        </form>
    </div>
    {% endif %}

    <div id="camera">
        {% if camera %}
            {% include "includes/camera.html" %}
        {% else %}
            This user has no registered camera.
        {% endif %}
    </div>

</div>

<div id="content-related">
    <div class="module" id="recent-actions-module">
        <h2>{{ page_user }} marked as friends:</h2>
        {#<h3>whatever</h3>#}
          {% if page_user.mutual_friends %}
            <ul>
                {% for f in page_user.mutual_friends %}
                    <li>
                        <a href="{% url social:user user_id=f.id %}">
                            {{ f.username }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
          {% else %}
            <p>None available</p>
          {% endif %}
    </div>
</div>

{% endblock %}
