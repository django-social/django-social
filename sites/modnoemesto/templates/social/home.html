{% extends "base.html" %}

{% load i18n %}
{% load media %}

{% block css %}
{{ block.super }}
<link href="/media/styles/user.css" rel="stylesheet" type="text/css" />
{% if profile.theme %}
<link href="{% url themes:file_view theme_id=profile.theme.id file_name='style.css' %}" rel="stylesheet" type="text/css" />
{% endif %}
{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="/media/js/flowplayer-3.js"></script>
<script type="text/javascript">
    var Timer = function (container) {
        if (container == undefined) return;
        function toStr(i) {
            return i < 10 && "0" + i || i;
        }
        var hday = $(".day", container),
            hhour = $(".hour", container),
            hminute = $(".minute", container),
            hsecond = $(".second", container);
        var day = hday && parseInt(hday.html()) || 0,
            hour = hhour && parseInt(hhour.html()) || 0,
            minute = hminute && parseInt(hminute.html()) || 0,
            second = hsecond && parseInt(hsecond.html()) || 0;


        this.intervalID = undefined;

        this.start = function () {
            if (this.intervalID != undefined) this.stop();
            this.intervalID = setInterval(function(){
                second--;
                if (second < 0) {
                    if (hour == minute == hour == 0) {
                        this.stop();
                        return;
                    }
                    second = 59;
                    minute--;
                    if (minute < 0) {
                        minute = 59;
                        hour--;
                        if (hour < 0) {
                            hour = 23;
                            day--;
                            hday.html(day);
                        }
                        hhour.html(toStr(hour));
                    }
                    hminute.html(toStr(minute));
                }
                hsecond.html(toStr(second));
            }, 1000);
        }
        this.stop = function () {
            clearInterval(this.intervalID);
            this.intervalID = undefined;
        }
    }

var timer = undefined;

$(document).ready(function() {
    $(".toollip_video").click(function (e){
        var width=810, height=645;
        window.open(e.target, 'video',
                'width='+width+',height='+height+',left='+($(window).width()-width)/2+',top='+($(window).height()-height)/2);
        return false;
    });
    timer = new Timer($("#timer"));
    {% if camera.is_view_paid and billing.can_show and billing.order.is_packet %}
    timer.start();
    {% endif %}
});
</script>
{% endblock %}

{% block content %}

<div id="user_page">
    <h2 class="name_persone">{{ page_user }}</h2>
     <div id="avatar" class="rounded">
        <img src="{% media_url page_user.avatar avatar_midi.png %}" />
    </div>
    {% if not is_owner %}
        {% if show_friend_button %}
       <a class="tooltip toollip_friend" href="{% url friends:add page_user.id %}">
            <span class="toollip_friend">
            <img src="/media/images/toollip_friend_2.png" width="206px" height="63px" /></span><img class="hidden" src="/media/images/tooltip_corner.png" /></a>
       {% else %}
       <a class="tooltip toollip_friend_remove" href="{% url friends:remove page_user.id %}">
            <span class="toollip_friend_remove">
            <img src="/media/images/toollip_friend_remove2.png" width="206px" height="63px" /></span><img class="hidden" src="/media/images/tooltip_corner.png" /></a>
      {% endif %}
       <a class="tooltip toollip_group" href="{% url groups:send_my_invites_to_user page_user.id %}">
            <span class="toollip_group">
            <img src="/media/images/toollip_group.png" width="206px" height="63px" /></span><img class="hidden" src="/media/images/tooltip_corner.png" /></a>
       
       <a class="tooltip toollip_mail" href="{% url user_messages:send_message page_user.id %}">
            <span class="toollip_mail">
            <img src="/media/images/toollip_mail.png" width="206px" height="63px" /></span><img class="hidden" src="/media/images/tooltip_corner.png" /></a>
       
       <a class="tooltip toollip_video" href="{% url social:user_conference page_user.id %}">
            <span class="toollip_video">
            <img src="/media/images/toollip_video.png" width="206px" height="63px" /></span><img class="hidden" src="/media/images/tooltip_corner.png" /></a>

    {% endif %}
    <div class="profileActions">
        <ul>
            {% if is_owner %}
                <li><a href="{% url social:profile_edit %}">{% trans "options" %}</a></li>
                <li><a href="{% url invite:send %}">Пригласить друзей к участию в видеосети</a> <b>({{ invitee_count }})</b></li>
                <li><a href="{% url friends:list %}">{% trans "Friends" %} ({{ page_user.friends.count }})</a></li>
            {% else %}
                {% if request.user.is_superuser %}
                    <li><a href="{% url social:profile_edit page_user.id %}">{% trans "options" %}</a></li>
                {% endif %}
                <li><a href="{% url notes:note_list page_user.id %}">{% trans "Notes" %}</a></li>
                <li><span>Приглашённые:</span><b> {{ invitee_count }}</b></li>
                <li><a href="{% url friends:friends_all page_user.id %}">{% trans "Friends" %} ({{ page_user.friends.count }})</a></li>
            {% endif %}
        </ul>
    </div>
    <div class="friend_box transparent">
       <div class="all_friends">
            <p>Друзья онлайн</p>
            {% if page_user.friends_online|length > 6 %} 
            <span><a href="{%if is_owner %}{% url friends:list %}{% else %}{% url friends:friends_all page_user.id %}{% endif %}"
            class="friends_amount">все {{ page_user.friends_online|length }}</a></span>
            {% endif %}
        </div>
        <ul class="friendTable clear">
            {% for user in page_user.friends_online|slice:":6" %}
                  <li>
                        {% include "includes/user/micro.html" %}
                  </li>
            {% endfor %}
        </ul>
    </div>
    
    <div id="general_info" class="about_persone transparent">
        <dl>
            {% if profile.hometown %}<dt id="hometown">{% trans "Hometown" %}</dt>
                <dd>{{ profile.hometown }}</dd>{% endif %}
            {% if profile.birthday %}<dt id="birthday">{% trans "Birthday" %}</dt>
                <dd>{{ profile.birthday }}</dd>{% endif %}
            {% if profile.sex %}<dt id="sex">{% trans "Sex" %}</dt>
                <dd>{{ profile.sex }}</dd>{% endif %}
        </dl>
    </div>
    <div id="contact_info" class="about_persone transparent">
        <p>{% trans "Contact Information" %}</p>
        <dl>
            {% if profile.icq %}<dt id="icq">{% trans "ICQ" %}</dt>
                <dd>{{ profile.icq }}</dd>{% endif %}
            {% if profile.mobile %}<dt id="mobile">{% trans "Mobile" %}</dt>
                <dd>{{ profile.mobile }}</dd>{% endif %}
            {% if profile.website %}<dt id="website">{% trans "Website" %}</dt>
                <dd><a href="{{ profile.website }}">{{ profile.website }}</a></dd>{% endif %}
        </dl>
    </div>
    <div id="education_info" class="about_persone transparent">
        <p>{% trans "Education" %}</p>
        <dl>
            {% if profile.university %}<dt id="university">{% trans "University" %}</dt>
                <dd>{{ profile.university }}</dd>{% endif %}
            {% if profile.department %}<dt id="department">{% trans "Department" %}</dt>
                <dd>{{ profile.department }}</dd>{% endif %}
            {% if profile.university_status %}<dt id="university_status">{% trans "Status" %}</dt>
                <dd>{{ profile.university_status }}</dd>{% endif %}
        </dl>
    </div>
    <div id="anounce_info" class="about_persone transparent">
             <p>{% trans "Announce" %}</p>
         <p class="event_announce">
             {{ profile.announce }}
         </p>
    </div>
		{% if camera %}
            {% if not is_owner %}
                {% if show_view_access_link %}
                    <a class="reference" href="{% url billing:get_view_access_to_camera camera.id %}">{% trans "Get view access to camera" %}</a>
                {% endif %}
                {% if show_manage_access_link %}
                    <a class="reference" href="{% url billing:get_manage_access_to_camera camera.id %}">{% trans "Get manage access to camera" %}</a>
                {% endif %}
                {% if show_bookmark_button %}
                <a class="reference" href="{% url cam:cam_bookmark_add camera.id %}">{% trans "Bookmark this camera" %}</a>
                {% else %}
                <a class="reference" href="{% url cam:cam_bookmark_delete camera.id %}">{% trans "Remove Bookmark" %}</a>
                {% endif %}
                {% if camera.is_view_paid and billing.can_show %}
                    <p id="timer">{% trans "The remaining time on the show" %}
                        {% if billing.show_data.days %} <span class="day">{{ billing.show_data.days}}</span> / {% endif %}
                        <span class="hour">{{ billing.show_data.hours|stringformat:"02i" }}</span> :
                        <span class="minute">{{ billing.show_data.minutes|stringformat:"02i" }}</span> :
                        <span class="second">{{ billing.show_data.seconds|stringformat:"02i" }}</span>
                    </p>
                {% endif %}
                {% if camera.manage_list %}
                        <table>
                            <thead>
                                <tr>
                                    <th>Пользователь</th>
                                    <th>Начало</th>
                                    <th>Окончание</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for i in camera.manage_list %}
                            <tr>
                                <td><a href="{% url social:user i.user.id %}">{{ i.user }}</a></td>
                                <td>{{ i.begin_date|date:"H:i:s" }}</td>
                                <td>{{ i.end_date|date:"H:i:s" }}</td>
                                <td>{% if forloop.first %}оператор{% endif %}</td>
                           </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                {% endif %}
            {% endif %}
            <div id="camera"><a name="cam"></a>
                {% include "includes/camera.html" %}
            </div>
        {% endif %}

</div>

{% endblock %}
